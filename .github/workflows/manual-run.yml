# yamllint disable rule:line-length
---
name: "Manual build"

on:  # yamllint disable-line rule:truthy
  workflow_dispatch:
    inputs:
      USE_PAID_RUNNERS:
        type: boolean
        description: "Use paid runners"
      MYTHBRANCH:
        type: choice
        description: "Choose a MythTV Version"
        options:
          - "master"
          - "fixes/35"
          - "fixes/34"
      PKGMGR:
        type: choice
        description: "Choose a package manager"
        options:
          - "homebrew"
          - "macports"
      BUILD_13:
        type: boolean
        description: "Build for macOS 13"
        default: false
      BUILD_14:
        type: boolean
        description: "Build for macOS 14"
        default: true
      BUILD_15:
        type: boolean
        description: "Build for macOS 15"
        default: true
      BUILD_26:
        type: boolean
        description: "Build for macOS 26"
        default: false
      ARCHITECTURE:
        type: choice
        description: "Choose an architecture"
        options:
          - "arm64"
          - "x86_64"
          - "all"
      BUILDTYPE:
        type: choice
        description: "Choose a build type"
        options:
          - "production"
          - "test"


run-name: "Manual Build: ${{ inputs.mythbranch }} by @${{ github.actor }}
  with ${{ inputs.PKGMGR }}"

jobs:
  check-inputs:
    runs-on: 'macos-latest'
    env:
      mythbranch: ${{ inputs.MYTHBRANCH }}
    steps:
      - name:
        run: |
          outputSTR="Building MyhtvTV Branch $mythbranch"
          echo $outputSTR
  #build-mythtv:
  #  needs: check-inputs
  #  if: inputs.PKGMGR == 'macports'
  #  uses: ./.github/workflows/build_sign_upload_legacy.yml
  #  with:
  #    USE_CCACHE: false
  #    MYTHBRANCH: ${{ inputs.MYTHBRANCH }}
  #    BUILDTYPE: ${{ inputs.BUILDTYPE }}
  #    ARCHITECTURE: ${{ inputs.ARCHITECTURE }}
  #  secrets: inherit
  build-mythtv-cmake:
    needs: check-inputs
    uses: ./.github/workflows/build_sign_upload.yml
    with:
      USE_CCACHE: false
      MYTHBRANCH: ${{ inputs.MYTHBRANCH }}
      BUILDTYPE: ${{ inputs.BUILDTYPE }}
      BUILD_13: ${{ inputs.BUILD_13 }}
      BUILD_14: ${{ inputs.BUILD_14 }}
      BUILD_15: ${{ inputs.BUILD_15 }}
      BUILD_26: ${{ inputs.BUILD_26 }}
      ARCHITECTURE: ${{ inputs.ARCHITECTURE }}
      PKGMGR: ${{ inputs.PKGMGR }}
      USE_PAID_RUNNERS: ${{ inputs.USE_PAID_RUNNERS }}
    secrets: inherit
